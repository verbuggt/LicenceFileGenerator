package net.exploit.licencegen.main;

import java.awt.EventQueue;
import java.awt.Font;
import java.awt.Toolkit;
import java.awt.datatransfer.StringSelection;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JTextField;
import javax.swing.JTextPane;

public class GUI {

	private LicenceGenerator licenceGenerator;
	private JFrame frmLicencegenerator;

	private JLabel lblUsername;
	private JLabel lblLicence;
	private JLabel lblMD5Hash;
	private JLabel lblPath;
	private JTextField txtUsername;
	private JTextPane txtLicence;
	private JTextPane txtMD5Hash;
	private JTextField txtPath;
	private JButton btnCopyUsername;
	private JButton btnCopyLicence;
	private JLabel lblStatus;

	public static void main(String[] args) {
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					GUI window = new GUI();
					window.frmLicencegenerator.setVisible(true);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
	}

	public GUI() {
		initialize();
	}

	private void initialize() {

		licenceGenerator = new LicenceGenerator(this);

		frmLicencegenerator = new JFrame();
		frmLicencegenerator.setResizable(false);
		frmLicencegenerator.setTitle("LicenceGenerator - by Felix | verbuqqt");
		frmLicencegenerator.setBounds(100, 100, 450, 275);
		frmLicencegenerator.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frmLicencegenerator.getContentPane().setLayout(null);

		lblUsername = new JLabel("Username:");
		lblUsername.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		lblUsername.setBounds(10, 14, 63, 14);
		frmLicencegenerator.getContentPane().add(lblUsername);

		lblLicence = new JLabel("Licence:");
		lblLicence.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		lblLicence.setBounds(10, 48, 63, 14);
		frmLicencegenerator.getContentPane().add(lblLicence);

		lblMD5Hash = new JLabel("MD5 Hash:");
		lblMD5Hash.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		lblMD5Hash.setBounds(10, 82, 63, 14);
		frmLicencegenerator.getContentPane().add(lblMD5Hash);

		lblPath = new JLabel("Path:");
		lblPath.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		lblPath.setBounds(10, 116, 46, 14);
		frmLicencegenerator.getContentPane().add(lblPath);

		txtUsername = new JTextField();
		txtUsername.setBounds(83, 11, 314, 23);
		frmLicencegenerator.getContentPane().add(txtUsername);
		txtUsername.setColumns(10);

		txtLicence = new JTextPane();
		txtLicence.setEditable(false);
		txtLicence.setBounds(83, 45, 314, 23);
		frmLicencegenerator.getContentPane().add(txtLicence);

		txtMD5Hash = new JTextPane();
		txtMD5Hash.setEditable(false);
		txtMD5Hash.setToolTipText("MD5 Hash-Value of the Licence");
		txtMD5Hash.setBounds(83, 79, 341, 23);
		frmLicencegenerator.getContentPane().add(txtMD5Hash);

		txtPath = new JTextField();
		txtPath.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		txtPath.setToolTipText("Path where the licence file is generated");
		txtPath.setText("LicenceGenerator/");
		txtPath.setBounds(83, 113, 341, 23);
		frmLicencegenerator.getContentPane().add(txtPath);
		txtPath.setColumns(10);

		ImageIcon icon = new ImageIcon(GUI.class.getResource("Copy_16x16_JFX.png"));

		btnCopyUsername = new JButton("");
		btnCopyUsername.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseClicked(MouseEvent e) {
				if (e.getButton() == MouseEvent.BUTTON1)
					copyStringToClipboard(txtUsername.getText(), "Username");
			}
		});
		btnCopyUsername.setIcon(icon);
		btnCopyUsername.setBounds(401, 11, 23, 23);
		frmLicencegenerator.getContentPane().add(btnCopyUsername);

		btnCopyLicence = new JButton("");
		btnCopyLicence.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseClicked(MouseEvent e) {
				if (e.getButton() == MouseEvent.BUTTON1)
					copyStringToClipboard(txtLicence.getText(), "Licence");
			}
		});
		btnCopyLicence.setIcon(icon);
		btnCopyLicence.setBounds(401, 45, 23, 23);
		frmLicencegenerator.getContentPane().add(btnCopyLicence);

		JButton btnGenerate = new JButton("Generate");
		btnGenerate.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseClicked(MouseEvent e) {
				if (e.getButton() == MouseEvent.BUTTON1)
					handleClick();
			}
		});
		btnGenerate.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		btnGenerate.setBounds(10, 160, 414, 40);
		frmLicencegenerator.getContentPane().add(btnGenerate);

		lblStatus = new JLabel("Status: \"Ich hab (allein) ein Lizenzsystem geschrieben\" - Vinco, 2017");
		lblStatus.setFont(new Font("Segoe UI", Font.PLAIN, 11));
		lblStatus.setBounds(10, 211, 414, 14);
		frmLicencegenerator.getContentPane().add(lblStatus);
	}

	protected void copyStringToClipboard(String s, String stringname) {
		if(s.isEmpty()) {
			setStatus(stringname + " is empty");
			return;
		}
		Toolkit.getDefaultToolkit().getSystemClipboard().setContents(new StringSelection(s), null);
		setStatus(stringname + " was copied to the clipboard");
	}

	protected void handleClick() {
		licenceGenerator.clickCallback(txtUsername.getText(), txtPath.getText());
	}

	public String getUsername() {
		return this.txtUsername.getText();
	}

	public void setStatus(String status) {
		this.lblStatus.setText("Status: " + status);
	}

	public void setUsername(String username) {
		this.txtUsername.setText(username);
	}

	public void setLicence(String licence) {
		txtLicence.setText(licence);
	}

	public void setHash(String hash) {
		txtMD5Hash.setText(hash);
	}
}
